<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDO Funcional</title>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            font-family: Arial; 
            padding: 20px; 
            text-align: center; 
        }
        
        h1 { 
            color: #00ff88; 
            margin-bottom: 30px; 
        }
        
        video { 
            width: 80%; 
            max-width: 600px; 
            height: 400px; 
            background: #333; 
            border: 3px solid #00ff88; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }
        
        .controls { 
            background: #222; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px auto; 
            max-width: 600px; 
        }
        
        button { 
            padding: 15px 25px; 
            margin: 10px; 
            background: #00ff88; 
            color: #000; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
        }
        
        button:hover { 
            background: #00cc6a; 
        }
        
        select { 
            padding: 10px; 
            margin: 10px; 
            background: #333; 
            color: #fff; 
            border: 2px solid #666; 
            border-radius: 6px; 
            font-size: 16px; 
        }
        
        .slider-group { 
            margin: 15px 0; 
            text-align: left; 
        }
        
        .slider-group label { 
            display: block; 
            margin-bottom: 5px; 
            color: #00ff88; 
        }
        
        .slider-group input { 
            width: 100%; 
            margin-bottom: 5px; 
        }
        
        .slider-value { 
            color: #fff; 
            font-weight: bold; 
        }
        
        .obs-section { 
            background: #333; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 20px; 
        }
        
        .obs-link { 
            background: #444; 
            padding: 10px; 
            border-radius: 5px; 
            font-family: monospace; 
            font-size: 12px; 
            word-break: break-all; 
            margin: 10px 0; 
            cursor: pointer; 
            user-select: all; 
        }
        
        .status { 
            background: #444; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 20px; 
            font-size: 14px; 
        }
    </style>
</head>
<body>
    <h1>📹 VDO.Ninja Funcional</h1>
    
    <video id="video" autoplay muted playsinline></video>
    
    <div class="controls">
        <button onclick="iniciar()">📹 INICIAR CÂMERA</button>
        <button onclick="parar()">⏹️ PARAR</button>
        <button onclick="trocar()">🔄 TROCAR CÂMERA</button>
        <button onclick="telaCheia()">🔳 TELA CHEIA</button>
        
        <br><br>
        
        <select id="camera">
            <option value="user">📱 Frontal</option>
            <option value="environment">📷 Traseira</option>
        </select>
        
        <select id="resolucao">
            <option value="720p30">720p @ 30fps</option>
            <option value="1080p30">1080p @ 30fps</option>
            <option value="1080p60">1080p @ 60fps</option>
            <option value="4k30">4K @ 30fps</option>
            <option value="4k60">4K @ 60fps</option>
        </select>
        
        <div class="slider-group">
            <label>🔍 Zoom: <span id="zoomVal">1.0x</span></label>
            <input type="range" id="zoom" min="1" max="10" value="1" step="0.1" 
                   oninput="atualizarZoom(this.value)">
        </div>
        
        <div class="slider-group">
            <label>💡 Brilho: <span id="brilhoVal">100%</span></label>
            <input type="range" id="brilho" min="0" max="200" value="100" step="5" 
                   oninput="atualizarBrilho(this.value)">
        </div>
        
        <div class="slider-group">
            <label>🎨 Contraste: <span id="contrasteVal">100%</span></label>
            <input type="range" id="contraste" min="50" max="200" value="100" step="5" 
                   oninput="atualizarContraste(this.value)">
        </div>
        
        <div class="slider-group">
            <label>🚀 Bitrate: <span id="bitrateVal">5000 kbps</span></label>
            <input type="range" id="bitrate" min="500" max="15000" value="5000" step="100" 
                   oninput="atualizarBitrate(this.value)">
        </div>
        
        <button onclick="aplicar()">✅ APLICAR CONFIGURAÇÕES</button>
        
        <div class="obs-section">
            <h3>🎥 OBS Studio</h3>
            <button onclick="gerarOBS()">🔗 GERAR LINK OBS</button>
            <div class="obs-link" id="obsLink" onclick="copiar()">
                Clique em "GERAR LINK OBS"
            </div>
        </div>
    </div>
    
    <div class="status" id="status">
        Sistema pronto - Clique "INICIAR CÂMERA"
    </div>

    <script>
        let stream = null;
        let track = null;
        let ativo = false;
        
        // Configurações
        let config = {
            camera: 'environment',
            resolucao: '1080p30',
            zoom: 1.0,
            brilho: 100,
            contraste: 100,
            bitrate: 5000
        };
        
        // Resoluções
        const resolucoes = {
            '720p30': { width: 1280, height: 720, frameRate: 30 },
            '1080p30': { width: 1920, height: 1080, frameRate: 30 },
            '1080p60': { width: 1920, height: 1080, frameRate: 60 },
            '4k30': { width: 3840, height: 2160, frameRate: 30 },
            '4k60': { width: 3840, height: 2160, frameRate: 60 }
        };
        
        async function iniciar() {
            try {
                document.getElementById('status').textContent = '⏳ Iniciando câmera...';
                
                // Parar anterior
                if (stream) {
                    stream.getTracks().forEach(t => t.stop());
                }
                
                // Pegar configurações
                config.camera = document.getElementById('camera').value;
                config.resolucao = document.getElementById('resolucao').value;
                
                const res = resolucoes[config.resolucao];
                
                // Iniciar câmera
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: res.width },
                        height: { ideal: res.height },
                        frameRate: { ideal: res.frameRate },
                        facingMode: config.camera
                    }
                });
                
                // Mostrar vídeo
                document.getElementById('video').srcObject = stream;
                track = stream.getVideoTracks()[0];
                ativo = true;
                
                // Aplicar filtros
                aplicarFiltros();
                
                // Status
                const settings = track.getSettings();
                document.getElementById('status').innerHTML = `
                    ✅ CÂMERA ATIVA<br>
                    📷 ${config.camera === 'user' ? 'Frontal' : 'Traseira'}<br>
                    📺 ${settings.width}x${settings.height}@${settings.frameRate || 'N/A'}fps<br>
                    🔍 Zoom: ${config.zoom}x | 💡 Brilho: ${config.brilho}% | 🎨 Contraste: ${config.contraste}%
                `;
                
                console.log('✅ Câmera iniciada:', settings);
                
            } catch (error) {
                console.error('❌ Erro:', error);
                document.getElementById('status').textContent = '❌ ERRO: ' + error.message;
            }
        }
        
        function parar() {
            if (stream) {
                stream.getTracks().forEach(t => t.stop());
                stream = null;
                track = null;
                ativo = false;
                
                document.getElementById('video').srcObject = null;
                document.getElementById('status').textContent = '⏹️ Câmera parada';
            }
        }
        
        function trocar() {
            config.camera = config.camera === 'user' ? 'environment' : 'user';
            document.getElementById('camera').value = config.camera;
            
            if (ativo) {
                parar();
                setTimeout(iniciar, 500);
            }
        }
        
        function telaCheia() {
            const video = document.getElementById('video');
            
            if (!ativo) {
                alert('⚠️ Inicie a câmera primeiro!');
                return;
            }
            
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else {
                alert('⚠️ Tela cheia não suportada neste navegador');
            }
        }
        
        function aplicar() {
            if (ativo) {
                parar();
                setTimeout(iniciar, 500);
            } else {
                document.getElementById('status').textContent = '✅ Configurações salvas! Inicie a câmera para aplicar.';
            }
        }
        
        function atualizarZoom(value) {
            config.zoom = parseFloat(value);
            document.getElementById('zoomVal').textContent = value + 'x';
            
            if (track) {
                try {
                    track.applyConstraints({ video: { zoom: config.zoom } });
                } catch (e) {
                    console.warn('Zoom não suportado');
                }
            }
        }
        
        function atualizarBrilho(value) {
            config.brilho = parseInt(value);
            document.getElementById('brilhoVal').textContent = value + '%';
            aplicarFiltros();
        }
        
        function atualizarContraste(value) {
            config.contraste = parseInt(value);
            document.getElementById('contrasteVal').textContent = value + '%';
            aplicarFiltros();
        }
        
        function atualizarBitrate(value) {
            config.bitrate = parseInt(value);
            const display = value >= 1000 ? (value / 1000).toFixed(1) + ' Mbps' : value + ' kbps';
            document.getElementById('bitrateVal').textContent = display;
        }
        
        function aplicarFiltros() {
            const video = document.getElementById('video');
            video.style.filter = `brightness(${config.brilho}%) contrast(${config.contraste}%)`;
        }
        
        function gerarOBS() {
            const baseUrl = window.location.href.split('?')[0];
            const obsUrl = baseUrl + '?obs=1&t=' + Date.now();
            
            document.getElementById('obsLink').textContent = obsUrl;
            
            document.getElementById('status').innerHTML = `
                🔗 LINK OBS GERADO!<br>
                <br>
                📋 NO OBS STUDIO:<br>
                1. Sources → Add → Browser Source<br>
                2. URL: (clique no link acima para copiar)<br>
                3. Width: 1920, Height: 1080<br>
                4. OK<br>
                <br>
                ✅ Câmera aparecerá automaticamente!
            `;
        }
        
        function copiar() {
            const texto = document.getElementById('obsLink').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(texto).then(() => {
                    alert('✅ Link copiado! Cole no OBS');
                });
            } else {
                alert('📋 Link: ' + texto);
            }
        }
        
        // Modo OBS
        const params = new URLSearchParams(window.location.search);
        if (params.get('obs') === '1') {
            document.body.innerHTML = `
                <video autoplay muted playsinline style="width: 100vw; height: 100vh; object-fit: cover; background: #000;"></video>
            `;
            
            // Auto-start para OBS
            navigator.mediaDevices.getUserMedia({
                video: { 
                    width: 1920, 
                    height: 1080, 
                    frameRate: 30, 
                    facingMode: 'environment' 
                }
            }).then(s => {
                document.querySelector('video').srcObject = s;
            }).catch(console.error);
        }
        
        // Inicialização
        console.log('🚀 VDO.Ninja Funcional carregado!');
    </script>
</body>
</html>
