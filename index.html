<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDO.Ninja PRO - CORRIGIDO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: linear-gradient(135deg, #000 0%, #111 100%);
            color: #fff; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            padding: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(0,255,136,0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #00ff88;
        }
        
        .logo {
            font-size: 2.5em;
            color: #00ff88;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0,255,136,0.5);
        }
        
        .subtitle {
            color: #ccc;
            margin-top: 10px;
        }
        
        /* Modo OBS - tela cheia */
        .obs-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
        }
        
        .obs-mode video {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }
        
        .video-section {
            background: rgba(34,34,34,0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #333;
        }
        
        .controls-panel {
            background: rgba(17,17,17,0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #00ff88;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        video {
            width: 100%;
            height: 400px;
            background: #222;
            border-radius: 10px;
            border: 3px solid #00ff88;
            margin-bottom: 15px;
        }
        
        .video-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff4444, #cc3333);
            color: #fff;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #666, #555);
            color: #fff;
        }
        
        .control-group {
            background: rgba(34,34,34,0.8);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #444;
        }
        
        .control-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1em;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }
        
        .control-label {
            min-width: 80px;
            font-size: 13px;
            color: #ccc;
        }
        
        .control-value {
            min-width: 80px;
            color: #00ff88;
            font-weight: bold;
            font-size: 14px;
        }
        
        select, input[type="range"] {
            flex: 1;
        }
        
        select {
            padding: 8px 12px;
            background: #333;
            color: #fff;
            border: 2px solid #555;
            border-radius: 6px;
            font-size: 14px;
        }
        
        select:focus {
            border-color: #00ff88;
            outline: none;
        }
        
        input[type="range"] {
            height: 6px;
            border-radius: 3px;
            background: #444;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .obs-section {
            background: rgba(255,68,68,0.1);
            border: 2px solid #ff4444;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .obs-link {
            background: #333;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            border: 1px solid #666;
            margin: 10px 0;
            cursor: pointer;
        }
        
        .obs-link:hover {
            background: #444;
        }
        
        .status-display {
            background: rgba(0,255,136,0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .copy-btn {
            background: #ff8800;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .controls-panel {
                max-height: none;
            }
            
            .logo {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="header">
            <div class="logo">📹 VDO.Ninja PRO</div>
            <div class="subtitle">Link OBS Funcional + Tela Cheia Corrigida</div>
        </div>
        
        <div class="main-grid">
            <div class="video-section">
                <video id="localVideo" autoplay muted playsinline></video>
                
                <div class="video-controls">
                    <button class="btn btn-primary" onclick="startCamera()">
                        📹 Iniciar Câmera
                    </button>
                    <button class="btn btn-danger" onclick="stopCamera()">
                        ⏹️ Parar
                    </button>
                    <button class="btn btn-secondary" onclick="switchCamera()">
                        🔄 Trocar Câmera
                    </button>
                    <button class="btn btn-secondary" onclick="enterFullscreen()">
                        🔳 Tela Cheia
                    </button>
                </div>
                
                <div class="obs-section">
                    <div class="control-title">🎥 Link para OBS Studio</div>
                    <button class="btn btn-primary" onclick="generateOBSLink()" style="width: 100%; margin-bottom: 10px;">
                        🔗 Gerar Link OBS Funcional
                    </button>
                    <div class="obs-link" id="obsLink" onclick="copyOBSLink()">
                        Clique em "Gerar Link OBS Funcional" para criar o link
                    </div>
                    <button class="copy-btn" onclick="copyOBSLink()" style="display: none;" id="copyBtn">
                        📋 Copiar Link
                    </button>
                    <div style="margin-top: 10px; font-size: 12px; color: #ccc;">
                        <strong>📋 Como usar no OBS:</strong><br>
                        1. Adicione "Browser Source"<br>
                        2. Cole o link gerado na URL<br>
                        3. Width: 1920, Height: 1080<br>
                        4. Marque "Shutdown source when not visible"<br>
                        5. Desmarque "Control audio via OBS"
                    </div>
                </div>
                
                <div class="status-display" id="streamStatus">
                    Aguardando inicialização...
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="control-group">
                    <div class="control-title">📱 Seleção de Câmera</div>
                    <select id="cameraSelect">
                        <option value="user">📱 Câmera Frontal</option>
                        <option value="environment">📷 Câmera Traseira</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-title">📺 Resolução & FPS</div>
                    <select id="resolutionSelect">
                        <option value="720p30">720p @ 30fps</option>
                        <option value="1080p30">1080p @ 30fps</option>
                        <option value="1080p60">1080p @ 60fps</option>
                        <option value="4k30">4K @ 30fps</option>
                        <option value="4k60">4K @ 60fps</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-title">🔍 Zoom Manual</div>
                    <div class="control-row">
                        <span class="control-label">Zoom:</span>
                        <input type="range" id="zoomSlider" min="1" max="10" value="1" step="0.1" 
                               oninput="updateZoom(this.value)">
                        <span class="control-value" id="zoomValue">1.0x</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-title">🚀 Bitrate</div>
                    <div class="control-row">
                        <span class="control-label">Qualidade:</span>
                        <input type="range" id="bitrateSlider" min="500" max="15000" value="5000" step="100"
                               oninput="updateBitrate(this.value)">
                        <span class="control-value" id="bitrateValue">5000 kbps</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-title">⚡ Latência</div>
                    <div class="control-row">
                        <span class="control-label">Delay:</span>
                        <input type="range" id="latencySlider" min="0" max="1000" value="50" step="10"
                               oninput="updateLatency(this.value)">
                        <span class="control-value" id="latencyValue">50 ms</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="applySettings()" 
                        style="width: 100%; padding: 15px; font-size: 16px; margin-top: 20px;">
                    ✅ APLICAR CONFIGURAÇÕES
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStream = null;
        let currentTrack = null;
        let isOBSMode = false;
        
        const config = {
            camera: 'environment',
            resolution: '1080p30',
            zoom: 1.0,
            bitrate: 5000,
            latency: 50
        };
        
        const resolutionConfigs = {
            '720p30': { width: 1280, height: 720, frameRate: 30 },
            '1080p30': { width: 1920, height: 1080, frameRate: 30 },
            '1080p60': { width: 1920, height: 1080, frameRate: 60 },
            '4k30': { width: 3840, height: 2160, frameRate: 30 },
            '4k60': { width: 3840, height: 2160, frameRate: 60 }
        };
        
        // Detectar modo OBS
        const urlParams = new URLSearchParams(window.location.search);
        isOBSMode = urlParams.get('obs') === 'true';
        
        if (isOBSMode) {
            // Modo OBS - interface limpa
            document.body.innerHTML = `
                <div class="obs-mode">
                    <video id="obsVideo" autoplay muted playsinline style="width: 100vw; height: 100vh; object-fit: cover; background: #000;"></video>
                </div>
            `;
            
            // Iniciar automaticamente no modo OBS
            setTimeout(startOBSCamera, 1000);
        }
        
        async function startCamera() {
            try {
                updateStatus('🔧 Iniciando câmera...');
                
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                const resConfig = resolutionConfigs[config.resolution];
                
                const constraints = {
                    video: {
                        width: { ideal: resConfig.width, max: resConfig.width },
                        height: { ideal: resConfig.height, max: resConfig.height },
                        frameRate: { ideal: resConfig.frameRate, max: resConfig.frameRate },
                        facingMode: config.camera
                    }
                };
                
                console.log('📹 Iniciando com constraints:', constraints);
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                currentTrack = currentStream.getVideoTracks()[0];
                
                const video = document.getElementById('localVideo');
                video.srcObject = currentStream;
                
                video.onloadedmetadata = function() {
                    const settings = currentTrack.getSettings();
                    
                    updateStatus(`
                        ✅ CÂMERA ATIVA<br>
                        📷 ${config.camera === 'user' ? 'Frontal' : 'Traseira'}<br>
                        📺 ${settings.width}x${settings.height} @ ${settings.frameRate || 'N/A'}fps<br>
                        🔍 Zoom: ${config.zoom}x<br>
                        🚀 Bitrate: ${config.bitrate >= 1000 ? (config.bitrate/1000).toFixed(1) + ' Mbps' : config.bitrate + ' kbps'}<br>
                        ⚡ Latência: ${config.latency}ms
                    `);
                };
                
            } catch (error) {
                console.error('❌ Erro:', error);
                updateStatus(`❌ ERRO: ${error.message}`);
            }
        }
        
        async function startOBSCamera() {
            try {
                // Configuração específica para OBS
                const constraints = {
                    video: {
                        width: { ideal: 1920, max: 1920 },
                        height: { ideal: 1080, max: 1080 },
                        frameRate: { ideal: 30, max: 60 },
                        facingMode: 'environment' // Sempre traseira para OBS
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('obsVideo');
                video.srcObject = stream;
                
                console.log('🎥 OBS Camera iniciada');
                
            } catch (error) {
                console.error('❌ Erro OBS:', error);
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #000; color: #fff; font-family: Arial; text-align: center;">
                        <div>
                            <h1 style="color: #ff4444; margin-bottom: 20px;">❌ Erro na Câmera</h1>
                            <p>${error.message}</p>
                            <p style="margin-top: 20px; color: #ccc;">Verifique as permissões da câmera</p>
                        </div>
                    </div>
                `;
            }
        }
        
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
                currentTrack = null;
                
                document.getElementById('localVideo').srcObject = null;
                updateStatus('⏹️ Câmera parada');
            }
        }
        
        function switchCamera() {
            config.camera = config.camera === 'user' ? 'environment' : 'user';
            document.getElementById('cameraSelect').value = config.camera;
            
            if (currentStream) {
                stopCamera();
                setTimeout(startCamera, 500);
            }
        }
        
        function enterFullscreen() {
            const video = document.getElementById('localVideo');
            
            if (!video || !currentStream) {
                alert('⚠️ Inicie a câmera primeiro!');
                return;
            }
            
            // Método corrigido para tela cheia
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else if (video.mozRequestFullScreen) {
                video.mozRequestFullScreen();
            } else if (video.msRequestFullscreen) {
                video.msRequestFullscreen();
            } else {
                // Fallback para dispositivos que não suportam
                video.style.position = 'fixed';
                video.style.top = '0';
                video.style.left = '0';
                video.style.width = '100vw';
                video.style.height = '100vh';
                video.style.zIndex = '9999';
                video.style.objectFit = 'cover';
                
                // Adicionar botão para sair
                const exitBtn = document.createElement('button');
                exitBtn.innerHTML = '❌ Sair da Tela Cheia';
                exitBtn.style.position = 'fixed';
                exitBtn.style.top = '20px';
                exitBtn.style.right = '20px';
                exitBtn.style.zIndex = '10000';
                exitBtn.style.padding = '10px 20px';
                exitBtn.style.background = '#ff4444';
                exitBtn.style.color = '#fff';
                exitBtn.style.border = 'none';
                exitBtn.style.borderRadius = '5px';
                exitBtn.style.cursor = 'pointer';
                
                exitBtn.onclick = function() {
                    video.style.position = '';
                    video.style.top = '';
                    video.style.left = '';
                    video.style.width = '';
                    video.style.height = '';
                    video.style.zIndex = '';
                    video.style.objectFit = '';
                    exitBtn.remove();
                };
                
                document.body.appendChild(exitBtn);
            }
        }
        
        function generateOBSLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            const timestamp = Date.now();
            
            // Link OBS funcional
            const obsUrl = `${baseUrl}?obs=true&t=${timestamp}&resolution=${config.resolution}&bitrate=${config.bitrate}`;
            
            document.getElementById('obsLink').innerHTML = obsUrl;
            document.getElementById('copyBtn').style.display = 'inline-block';
            
            updateStatus(`
                🔗 LINK OBS GERADO!<br>
                <br>
                📋 INSTRUÇÕES DETALHADAS:<br>
                1. Copie o link clicando nele<br>
                2. No OBS Studio: Sources → Add → Browser Source<br>
                3. Cole a URL no campo "URL"<br>
                4. Width: 1920, Height: 1080<br>
                5. FPS: 30<br>
                6. ✅ Shutdown source when not visible<br>
                7. ❌ Control audio via OBS (desmarcar)<br>
                8. Clique OK<br>
                <br>
                ✅ O vídeo aparecerá automaticamente no OBS!
            `);
        }
        
        function copyOBSLink() {
            const linkText = document.getElementById('obsLink').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(linkText).then(() => {
                    alert('✅ Link copiado! Cole no OBS Browser Source.');
                });
            } else {
                // Fallback para dispositivos sem clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = linkText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('✅ Link copiado! Cole no OBS Browser Source.');
            }
        }
        
        function updateZoom(value) {
            config.zoom = parseFloat(value);
            document.getElementById('zoomValue').textContent = value + 'x';
        }
        
        function updateBitrate(value) {
            config.bitrate = parseInt(value);
            const display = value >= 1000 ? (value / 1000).toFixed(1) + ' Mbps' : value + ' kbps';
            document.getElementById('bitrateValue').textContent = display;
        }
        
        function updateLatency(value) {
            config.latency = parseInt(value);
            document.getElementById('latencyValue').textContent = value + ' ms';
        }
        
        function applySettings() {
            config.camera = document.getElementById('cameraSelect').value;
            config.resolution = document.getElementById('resolutionSelect').value;
            
            updateStatus('⚙️ Aplicando configurações...');
            
            if (currentStream) {
                stopCamera();
                setTimeout(startCamera, 1000);
            } else {
                updateStatus('✅ Configurações salvas! Inicie a câmera para aplicar.');
            }
        }
        
        function updateStatus(message) {
            const statusElement = document.getElementById('streamStatus');
            if (statusElement) {
                statusElement.innerHTML = message;
            }
        }
        
        // Inicialização
        if (!isOBSMode) {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🚀 VDO.Ninja PRO carregado!');
                
                document.getElementById('cameraSelect').value = config.camera;
                document.getElementById('resolutionSelect').value = config.resolution;
                
                updateStatus('📱 VDO.Ninja PRO carregado!<br>Link OBS e Tela Cheia corrigidos!');
            });
        }
    </script>
</body>
</html>
